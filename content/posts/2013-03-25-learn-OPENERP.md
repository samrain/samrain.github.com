---
layout : post
category : tech
tags : [OPENERP, ERP, python]
title : OPENERP Step by Step
date : 2013-03-25
---
[思维导图文件下载](https://docs.google.com/file/d/0B1DrsqrLRzeIU2czNzAwQXp0YVk/edit?usp=sharing)


## 最重要目标


### 通过信息的集成,实现业务间的集成

- 企业基础资源数字化
- 业务处理数字化
- 管理信息化

## 模块


- 项目管理


- 文档管理


- 电子数据交换（EDI）


- 跟踪软件bug的项目管理工具


- 个人生产力工具


- 采购管理


- 销售管理


- 库存管理


- 财务管理


- 货品管理


- 营销管理


- 客户关系管理


- 生产管理


- 人事管理


- 服务支持


## 安装


### ubuntu

<pre>
sudo apt-get install openerp6.1-full
sudo su postgres
createuser -d #linux-username# -R -P
#input password#
#confirm by super role#
</pre>

## 启停

<pre>
sudo /etc/init.d/openerp-server start
sudo /etc/init.d/openerp-server stop
</pre>

## 默认访问


### 访问地址:[http://localhost:8069](http://localhost:8069)

- 修改文件/etc/openerp/openerp-server.conf可以改变URL

### 第一次访问

- Database中没有可选项
- 也无法用用户名和密码登录

## 初始设置


### 创建第一个database

- 点击【Manage Databases】
- 点击【CREATE】
- 输入database名称、选择语言为【中文】、输入新库的用户“admin”的密码
- 【Master password】默认是“admin”，可以点击【PASSWORD】修改
- 测试帐号、密码

<pre>
Master password:Pass@word
    - database HgERP
Admin:2nmpNf4&^Mgl4Iw$rJHg
</pre>

### 设置公司信息

- 点击：设置->公司->公司
- 完成：公司名称、联系方式、地址、报表页眉和页脚以及业务来往结算币种、公司logo

### 设定默认用户偏好

- 在设置页面内容部分中点击【定制默认用户偏好】 
- 选择了【界面】为“简单”

### 安装必要的模块

- CRM account_voucher accout_accountant sale stock mrp purchase
- 会计与财务(account_accountant):会计科目，应收应付账款记账，基本会计报表
 - 安装过程中会提示设置会计科目表。系统内置了很多国家的包括中国的。
- 出纳(收付款)模块(account_voucher):实收实付款记账
 - 安装完后在会计菜单中多了客户付款和供应商付款
- 销售管理(sale):销售订单的处理
 - 安装完后增加了销售和仓库模块及其菜单
- 采购管理(purchase):采购订单的处理
- 仓库管理(stock):入库、出库及库存报表等，销售管理和采购管理依赖该模块，所以在安装以上模块的时候就会自动安装该模块

### 调整计价基础和价格表的币种

- 销售-设置-价格表-计价基础
- 销售-设置-价格表-价格表
- 采购-设置-价格表-价格表

### 设置会计科目

- 如果是初始设置为中国会计科目，那么这里就不用设置了，否则到会计-设置-财务会计-科目-科目

## 测试使用设置


### 设置客户和供应商

- 客户和供应商是同一个设置画面
 - 销售-地址簿-客户
 - purchase-address book-supplier
 - 会计-客户-客户
 - 会计-供应商列表-供应商列表
- 一般
    - 地址
        - 一般有三种：默认、收票和收货
        - 默认：当没有其他地址时使用此地址
        - 发票：系统生成财务票据时使用的地址
        - 发货：系统生成送货单时使用的地址
- 会计
 - 设置应收科目和应付款
- 范例中设置客户和供应商各一个

### 设置产品单位信息

- 销售-设置-产品-计量单位-计量单位
- 【计量单位类型】选择“大于引用的计量单位”

### 设置产品基本信息

- 新建
    - 销售-产品-产品
    - purchase-产品-产品
    - 仓库-产品-产品
- 录入
    - 信息
        - 名称,可以卖出，可被采购，产品类型，获得方式，供应方式，标价，成本计算方法，Cost Price，默认计量单位，采购计量单位
    - 需求与货位
        - 新建[最少库存规则]
    - 供应商
        - 新建的供应商作为默认供应商
    - 会计
        - 修改【盘点估值】为“实时（自动进行）”，使得在出入库时自动生成出入库对应的库存会计凭证
        - 入库科目、出库科目、收益科目和费用科目可在产品或产品分类中配置，且前者优先级大于后者
        - 一般建议先设置"所有产品"
            - 销售-设置-产品-产品分类
            - 入库科目：在途物质
            - 出库科目：主营业务成本
            - Stock Valuation Account：库存商品
            - 收益科目：主营业务收入
            - 费用科目：在途物质

## 销售订单处理


### 创建销售订单

- 销售-sales-销售订单
- 选择销售的客户，点击“新建”录入销售订单明细
- 如果库存小于需要量，那么会弹出警告框
- 点击【保存并关闭】
- 点击【报价单/订单】打印报价单并传送给客户
- 点击【确认订单】将生成最终的销售订单
- 点击【生成最终发票】生成内部发票草稿。
内部发票用于通知财务收付款。财务确认内部发票时候，系统会根据内部发票自动生成应收、应付账款。

### 生成销售出库单

- 当销售订单确认时，自动生成出库单

### 生成采购询价单

- 运行MRP，系统根据最小库存规则自动生成采购询价单。设置好MRP计划执行周期系统自动运行MRP
- 手工运行MRP
    - 仓库-排程-计划运行
    - 点击【计划运行】
- 查看：purchase-采购管理-询价单
    - 供应商为该产品设置的默认供应商

### 生成采购订单

- 采购询价单中点击按钮【转换成采购订单】

### 生成采购入库单

- 采购订单确认后，自动生成入库单

### 生成财务收款/付款通知单（系统中叫客户发票/供应商发票）


### 入库

- 仓库-仓库管理-入库
- 点击按钮【处理】
- 点击按钮【Validate】

### 出库

- 仓库-仓库管理-送货单
- 如果送货单的状态为“waiting available”，表示库存不足不可以出货。
- 点击按钮【检查可用】，系统检测库存是否够了。如果够那么变为“可用”。这时可以点击按钮【处理】
- 点击按钮【Validate】

## 会计处理


### 销售收款

- 会计-客户-客户发票
- 一般流程：当我们开具税务发票给客户的时候,我们确认系统的“客户发票”,系统自动生成应收账款会计凭证
- 财务开具发票传送给客户,并在系统中点击按钮【使其生效】,将发票进行核准。
- 当收到客户付款时候,找到对应的付款发票,点击按钮【付款】。系统弹出付款单,输入【已付金额】和【付款方式】,点击按钮【记账】系统自动生成实收款会计凭证,核销(勾稽)对应应收账款。

### 采购付款

- 会计-供应商列表-供应商发票
- 类似销售付款
- 系统根据采购订单生成了供应商发票点开它。当收到供应商开具税务发票时候,确认“供应商发票”,当实际付款给供应商时候,作付款处理。
- 收到供应商实际开具的发票后,点击按钮【核准】，与系统中的供应商发票进行核准，发票的状态变为“打开”。
- 收到供应商发票并付款后,在系统中进行客户付款和记帐。点击“支付发票”按钮。录入实际付款金额和付款方式。点击“记账”。状态为“已登帐”

### 会计凭证查询

- 会计-账簿的分录-账簿明细
- 完成会计处理的同时系统会自动生成会计凭证
- 会计分录
    - 入库
        - 借:库存商品
        - 贷:在途物资
    - 出库
        - 借:主营业务成本
        - 贷:库存商品
    - 销售发票核准
        - 借:应收账款
        - 贷:主营业务收入
    - 销售回款
        - 借:银行
        - 贷:应收账款
    - 采购发票核准
        - 借:在途物资
        - 贷:应付账款
    - 采购付款
        - 借:应付账款
        - 贷:银行

## 总结


### 采购-入库

- 采购意向一般有2个来源：销售订单和库存偏低（根据最小库存规则-采购询价单）

### 销售-出库


### 自动登记财务帐务

- 销售会计记账及收款
- 采购会计记账及付款
- 定期出具财务报表,如应收应付款报表,损益表

### 仓库业务处理

- 出库
- 入库
- 库间调拨
- 盘点

## 问题


### database是指真实的数据库还是指帐套

- 指的是帐套
- 通常会创建多个帐套，例如一个用于测试，一个用于生产应用

### [打印的PDF文件中文显示为乱码](http://shine-it.net/index.php/topic,2791.0.html)

- 到http://v6apps.openerp.com/上搜索“oecn_base_font”
- 下载补丁文件
- 解压后复制到addons目录中
    - 如果是apt装的，那么在【/usr/share/openerp/addons】
    - 否则可以用命令 strace openser-server来查找程序目录
- 设置admin用户的权限
    - 添加权限[Technical Features]
- 在菜单【模块】点击【更新模块列表】
    - 点击【更新】
    - 点击【打开模块】
    - 在[名称]中输“oecn”，点击搜索
    - 模块【oecn_base_fonts】点击【安装】(如果是一行显示的，那么点击最后面的绿色图标)
- 在菜单【设置】->【设置向导】->【设置向导】
    - 搜索“pdf”
    - 点击动作为【配置pdf字体替换规则】的记录齿轮图标
    - 将【替换为】修改为"WenQuanYiMicroHei"，点击右边的存盘图标
    - 点击按钮【Apply】
    - 如果在更新最后一个字体的时候碰到报错，关闭提示框，然后新建最后一个字体，再指定"WenQuanYiMicroHei"，点击右边的存盘图标
- 重启openerp服务

### 看不见用户组

- 在设置页面内容部分中点击【定制默认用户偏好】 
- 选择了【界面】为“简单”

### 建立数据库报错：locale问题

- 先装数据库，将会导致生成一个demo数据库，必须要删除他
- 或者删除postgresql，然后直接安装openerp，这时将会连带安装

### 安装中国会计科目模块后，会计科目的编号全部变成6位

- 安装模块的时候应该先安装“account_accountant”再安装别的依赖“account”的模块。
- 自动截取成4位 UPDATE account_account SET code=overlay(code placing '' from 5 for 2) WHERE code like '%00' AND char_length(code)=6

