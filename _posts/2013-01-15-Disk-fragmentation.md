---
layout : post
category : tech
tags : [fragmentation, disk, linux, 磁盘碎片]
title : 解密磁盘碎片
---
[思维导图文件下载](https://docs.google.com/file/d/0B1DrsqrLRzeIbTZEU2dMQkJ0MjA/edit)

## WHY


### 磁盘驱动器上有很多扇区，每个扇区都能存放一小段数据。 文件，特别是大文件的存储需要占用很多不同的扇区。 假设现在你有很多个文件存在的文件系统里， 每个文件都会被存储在一系列连续的扇区里。 后来你更新了其中的一个文件，它的体积变大了。 文件系统会尝试把文件新增的部分存放到紧邻原始文件的扇区里。 可不幸的是，它周边已经没连续的足够扇区空间了，文件需要被分割成数段——这些都在自动进行的。 当从磁盘上读取这个文件时，磁盘磁头需要跨越数个不同的物理位置来读取各个扇区


## WHAT


### 使速度降低


## WHO


### 硬盘类型

- 机械硬盘
- 固态硬盘

### OS

- Windows
- Linux

## HOW


### Windows

- FAT
当你把一个文件存入FAT文件系统里时， 系统会尽量的把它存到靠近磁盘开始的地方。 当你存入第二个文件时， 它会紧接着第一个文件——一个接着一个。 当原始文件体积变大后，它们一定会产生碎片。 根本没有留给它们增长的空间。
- NTFS
它会在磁盘上在文件周围分配一些“缓冲”的空闲空间， 尽管如此，任何Windows用户都会告诉你， 经过一段时间的使用后，NTFS文件系统还是会形成碎片。

### Linux

- EXT4
把所有文件都分散到了整个磁盘上， 每两个文件之间都留有相当巨大的空闲空间。 当文件被修改、体积增加时，它们通常有足够的空间来扩展。

## 磁盘整理


### Windows

- 通过在后台运行一个磁盘碎片整理进程来解决这个问题

### Linux

- 一旦有碎片产生时，文件系统会尝试移动整个文件来消除碎片， 所以你不需要一个碎片整理工具。
- 如果你真想整理一个文件系统， 这最简单的方式也许是最可靠的方式： 把文件从这个分区里考出，删除这些文件， 然后考回这些文件。 当你把文件考回硬盘时，文件系统会智能为文件分配存储空间。